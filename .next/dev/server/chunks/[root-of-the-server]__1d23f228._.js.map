{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Portal%20All%20Clean%20Masters/CleanMasters2/lib/prisma.ts"],"sourcesContent":["// ============================================\n// LIB/PRISMA.TS\n// ============================================\n// üÜï NUEVO - Copiar a: CleanMasters2/lib/prisma.ts\n\nimport { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA,+CAA+C;AAC/C,gBAAgB;AAChB,+CAA+C;AAC/C,mDAAmD;AAEnD;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///C:/Portal%20All%20Clean%20Masters/CleanMasters2/app/api/crews/%5Bid%5D/members/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { prisma } from '@/lib/prisma'\r\n\r\n// 1. Mapa de traducci√≥n (Espa√±ol -> Base de Datos)\r\nconst ROLE_MAPPING: Record<string, string> = {\r\n  'Lider': 'LEADER',\r\n  'L√≠der': 'LEADER',\r\n  'Leader': 'LEADER',\r\n  'Asistente': 'ASSISTANT',\r\n  'Assistant': 'ASSISTANT',\r\n  'Conductor': 'DRIVER',\r\n  'Driver': 'DRIVER',\r\n  'Limpiador': 'CLEANER',\r\n  'Cleaner': 'CLEANER'\r\n}\r\n\r\nexport async function POST(\r\n  req: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params\r\n    const body = await req.json()\r\n\r\n    console.log(\"üìù Solicitud de nuevo miembro:\", body.name)\r\n    console.log(\"üé≠ Rol recibido:\", body.role)\r\n\r\n    // 2. Validaci√≥n y Traducci√≥n del Rol\r\n    let dbRole = ROLE_MAPPING[body.role] || body.role.toUpperCase();\r\n    \r\n    // Si la traducci√≥n fall√≥ o no existe, forzamos un valor seguro\r\n    const validRoles = ['LEADER', 'ASSISTANT', 'DRIVER', 'CLEANER'];\r\n    if (!validRoles.includes(dbRole)) {\r\n       console.warn(`‚ö†Ô∏è Rol desconocido \"${body.role}\", asignando ASSISTANT por defecto.`);\r\n       dbRole = 'ASSISTANT';\r\n    }\r\n\r\n    const experienceInt = parseInt(body.experience?.toString() || '0', 10)\r\n\r\n    const member = await prisma.crewMember.create({\r\n      data: {\r\n        crewId: id,\r\n        name: body.name,\r\n        role: dbRole, // <--- Usamos el rol traducido\r\n        phone: body.phone || null,\r\n        email: body.email || null,\r\n        experience: experienceInt,\r\n        isActive: true,\r\n        photoUrl: body.photoUrl || null\r\n      }\r\n    })\r\n\r\n    console.log(\"‚úÖ Miembro contratado:\", member.id)\r\n    return NextResponse.json(member, { status: 201 })\r\n\r\n  } catch (error: any) {\r\n    console.error('‚ùå Error al guardar miembro:', error.message)\r\n    return NextResponse.json(\r\n      { error: 'Error: ' + error.message },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function GET(\r\n  req: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params\r\n    const members = await prisma.crewMember.findMany({\r\n      where: { crewId: id },\r\n      orderBy: { name: 'asc' }\r\n    })\r\n    return NextResponse.json(members)\r\n  } catch (error) {\r\n    return NextResponse.json({ error: 'Failed to fetch members' }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,mDAAmD;AACnD,MAAM,eAAuC;IAC3C,SAAS;IACT,SAAS;IACT,UAAU;IACV,aAAa;IACb,aAAa;IACb,aAAa;IACb,UAAU;IACV,aAAa;IACb,WAAW;AACb;AAEO,eAAe,KACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,QAAQ,GAAG,CAAC,kCAAkC,KAAK,IAAI;QACvD,QAAQ,GAAG,CAAC,oBAAoB,KAAK,IAAI;QAEzC,qCAAqC;QACrC,IAAI,SAAS,YAAY,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,WAAW;QAE7D,+DAA+D;QAC/D,MAAM,aAAa;YAAC;YAAU;YAAa;YAAU;SAAU;QAC/D,IAAI,CAAC,WAAW,QAAQ,CAAC,SAAS;YAC/B,QAAQ,IAAI,CAAC,CAAC,oBAAoB,EAAE,KAAK,IAAI,CAAC,mCAAmC,CAAC;YAClF,SAAS;QACZ;QAEA,MAAM,gBAAgB,SAAS,KAAK,UAAU,EAAE,cAAc,KAAK;QAEnE,MAAM,SAAS,MAAM,yHAAM,CAAC,UAAU,CAAC,MAAM,CAAC;YAC5C,MAAM;gBACJ,QAAQ;gBACR,MAAM,KAAK,IAAI;gBACf,MAAM;gBACN,OAAO,KAAK,KAAK,IAAI;gBACrB,OAAO,KAAK,KAAK,IAAI;gBACrB,YAAY;gBACZ,UAAU;gBACV,UAAU,KAAK,QAAQ,IAAI;YAC7B;QACF;QAEA,QAAQ,GAAG,CAAC,yBAAyB,OAAO,EAAE;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC,QAAQ;YAAE,QAAQ;QAAI;IAEjD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,+BAA+B,MAAM,OAAO;QAC1D,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,YAAY,MAAM,OAAO;QAAC,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,UAAU,MAAM,yHAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;YAC/C,OAAO;gBAAE,QAAQ;YAAG;YACpB,SAAS;gBAAE,MAAM;YAAM;QACzB;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF"}}]
}